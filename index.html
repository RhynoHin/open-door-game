<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è€ç«‡é–‹é–€éŠæˆ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #ffe9a9, #f9c4ff, #8fd3ff);
    }

    .game-wrapper {
      background: #ffffffdd;
      border-radius: 18px;
      padding: 18px 16px 20px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.18);
      border: 2px solid #333;
    }

    h1 {
      margin: 0 0 6px;
      text-align: center;
      font-size: 1.4rem;
    }

    .subtitle {
      text-align: center;
      font-size: 0.8rem;
      color: #555;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .status-bar {
      font-size: 0.8rem;
      background: #f3f3f3;
      border-radius: 10px;
      padding: 8px 10px;
      margin-bottom: 10px;
      border: 1px dashed #bbb;
    }

    .status-bar span.label {
      font-weight: 600;
    }

    .door-area {
      position: relative;
      margin: 10px auto 12px;
      width: 260px;
      height: 200px;
      background: linear-gradient(135deg, #654321, #4a2e18);
      border-radius: 14px;
      border: 3px solid #2b1a0f;
      overflow: hidden;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .door-inner {
      position: relative;
      width: 92%;
      height: 92%;
      margin-bottom: 6px;
      background: repeating-linear-gradient(
        90deg,
        #7a4b26 0,
        #7a4b26 18px,
        #8a5a30 18px,
        #8a5a30 36px
      );
      border-radius: 10px;
      border: 2px solid #2b1a0f;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    .door-inner.open {
      transform: rotateY(-18deg) translateX(-6px);
      box-shadow: 10px 0 18px rgba(0, 0, 0, 0.35);
      background: linear-gradient(135deg, #fff9d2, #ffe0e9);
    }

    .door-inner.resting {
      filter: grayscale(0.4) brightness(0.8);
    }

    .door-inner::before {
      content: "";
      position: absolute;
      right: 16px;
      width: 12px;
      height: 12px;
      background: radial-gradient(circle, #ffd966, #d49b28);
      border-radius: 50%;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
    }

    .dad-face {
      position: relative;
      z-index: 1;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: #ffe4c4;
      border: 3px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      box-shadow: 0 3px 0 #d1b090;
    }

    .dad-face::before {
      /* é ­é«® */
      content: "";
      position: absolute;
      top: -3px;
      width: 120%;
      height: 52%;
      background: radial-gradient(circle at top, #333, #111);
      border-radius: 80% 80% 40% 40%;
      z-index: -1;
    }

    .dad-face.mad {
      background: #ffb3b3;
    }

    .dad-face.happy {
      background: #ffecc2;
    }

    .speech-bubble {
      position: absolute;
      top: 6px;
      left: 10px;
      right: 10px;
      margin: auto;
      width: 88%;
      min-height: 46px;
      background: #ffffffee;
      border-radius: 12px;
      padding: 6px 8px;
      font-size: 0.78rem;
      border: 2px solid #333;
      line-height: 1.4;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .speech-bubble::after {
      content: "";
      position: absolute;
      bottom: -6px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px 6px 0 6px;
      border-style: solid;
      border-color: #333 transparent transparent transparent;
    }

    .speech-bubble::before {
      content: "";
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px 6px 0 6px;
      border-style: solid;
      border-color: #ffffffee transparent transparent transparent;
      z-index: 1;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    button {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.15s;
      box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
      white-space: nowrap;
    }

    button:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
    }

    .btn-big {
      background: linear-gradient(135deg, #ff91c7, #ff5da2);
      color: #fff;
    }

    .btn-small {
      background: linear-gradient(135deg, #ffe066, #ffb347);
      color: #5b3b00;
    }

    .info-line {
      font-size: 0.75rem;
      color: #555;
      text-align: center;
      margin-bottom: 4px;
    }

    .footer-note {
      font-size: 0.7rem;
      text-align: center;
      color: #888;
      margin-top: 4px;
    }

    .shake {
      animation: shake 0.35s ease;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    .pop {
      animation: pop 0.25s ease;
    }

    @keyframes pop {
      0% { transform: scale(0.9); }
      70% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @media (max-width: 480px) {
      .game-wrapper {
        max-width: 94%;
      }
      .door-area {
        width: 230px;
        height: 185px;
      }
      .speech-bubble {
        font-size: 0.76rem;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <h1>è€ç«‡é–‹é–€æ¨¡æ“¬å™¨</h1>
    <div class="subtitle">
      æ˜ŸæœŸä¸€è‡³äº” <strong>18:00</strong> æ‰ç•¶å€¼ã€‚<br />
      å¤§å¥³ï¼é–‹é–€è¶…é–‹å¿ƒï¼Œç´°å¥³ï¼è€ç«‡ç«éƒ½åšŸã€‚
    </div>

    <div class="status-bar">
      <div><span class="label">ç¾åœ¨æ™‚é–“ï¼š</span><span id="time-text">--:--</span></div>
      <div><span class="label">ä»Šæ—¥ç‹€æ…‹ï¼š</span><span id="day-status">è¼‰å…¥ä¸­...</span></div>
    </div>

    <div class="door-area">
      <div class="speech-bubble" id="bubble">
        å®å®å®ï½ç­‰äººæ•²é–€å…ˆå•¦ã€‚
      </div>
      <div class="door-inner" id="door">
        <div class="dad-face" id="dad-face">
          ğŸ˜´
        </div>
      </div>
    </div>

    <div class="info-line">
      â€» åªæœ‰<strong>æ˜ŸæœŸä¸€è‡³äº” 18:00</strong>å…ˆæœƒæ­£å¼å¹«å¤§å¥³é–‹é–€ã€‚
    </div>

    <div class="buttons-row">
      <button class="btn-big" id="btn-big">ğŸ‘§ å¤§å¥³æ•²é–€</button>
      <button class="btn-small" id="btn-small">ğŸ§’ ç´°å¥³æ•²é–€</button>
    </div>

    <div class="footer-note">
      å°è²¼å£«ï¼šä½ å¯ä»¥æ¯æ—¥ 18:00 å†åšŸè©¦ä¸‹ï¼Œç‡å“è€ç«‡å¿ƒæƒ…é»ã€‚
    </div>
  </div>

  <script>
    // ========= æ™‚é–“ & ç‹€æ…‹é‚è¼¯ =========
    function getStatus() {
      const now = new Date();
      const day = now.getDay(); // 0 = Sunday
      const hour = now.getHours();
      const minute = now.getMinutes();

      const isWeekend = (day === 0 || day === 6);
      const isOnDutyTime = (!isWeekend && hour === 18); // æ˜ŸæœŸä¸€è‡³äº” 18:00

      return { now, day, hour, minute, isWeekend, isOnDutyTime };
    }

    function pad2(n) {
      return n.toString().padStart(2, "0");
    }

    function getDayName(day) {
      const map = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
      return map[day] || "";
    }

    function updateTimePanel() {
      const { now, day, hour, minute, isWeekend, isOnDutyTime } = getStatus();
      const timeText = document.getElementById("time-text");
      const dayStatus = document.getElementById("day-status");

      timeText.textContent =
        `${now.getFullYear()}-${pad2(now.getMonth() + 1)}-${pad2(now.getDate())} `
        + `${pad2(hour)}:${pad2(minute)} (${getDayName(day)})`;

      if (isWeekend) {
        dayStatus.textContent = "é€±æœ«æ¨¡å¼ï¼šè€ç«‡æ”¾å‡ç“åˆ°åçœ¼ï¼Œå””æ¥å®¢ã€‚";
      } else if (isOnDutyTime) {
        dayStatus.textContent = "ç•¶å€¼æ™‚é–“ï¼šè€ç«‡å·²ç¶“æ”¶å·¥è¿”å±‹ä¼ï¼Œå¯ä»¥å¹«å¤§å¥³é–‹é–€ã€‚";
      } else {
        dayStatus.textContent = "å¹³æ—¥é 18:00ï¼šè€ç«‡ä»²å¿™ç·Šï¼Œå¿ƒæƒ…å””å¤ªç©©å®šã€‚";
      }

      const door = document.getElementById("door");
      if (isWeekend) {
        door.classList.add("resting");
      } else {
        door.classList.remove("resting");
      }
    }

    setInterval(updateTimePanel, 1000);
    updateTimePanel();

    // ========= è²æ•ˆï¼ˆWeb Audioï¼‰ =========
    let audioCtx = null;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === "suspended") {
        audioCtx.resume();
      }
    }

    function playBeep(freq = 440, duration = 0.15, type = "sine", volume = 0.3) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.value = volume;

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      const now = audioCtx.currentTime;
      osc.start(now);
      osc.stop(now + duration);

      // å¹³æ»‘æ”¶å°¾
      gain.gain.setValueAtTime(volume, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
    }

    function playHappySound() {
      // å°å’Œå¼¦ + å…©è²å½ˆè·³
      playBeep(660, 0.12, "triangle", 0.35);
      setTimeout(() => playBeep(880, 0.12, "triangle", 0.3), 120);
      setTimeout(() => playBeep(660, 0.18, "triangle", 0.3), 260);
    }

    function playAngrySound() {
      playBeep(160, 0.18, "square", 0.35);
      setTimeout(() => playBeep(120, 0.18, "square", 0.35), 190);
    }

    function playNeutralSound() {
      playBeep(440, 0.12, "sine", 0.25);
    }

    // ========= éŠæˆ²äº’å‹• =========
    const btnBig = document.getElementById("btn-big");
    const btnSmall = document.getElementById("btn-small");
    const bubble = document.getElementById("bubble");
    const door = document.getElementById("door");
    const dadFace = document.getElementById("dad-face");

    function setDadMood(mood) {
      // mood: "sleep" | "happy" | "mad" | "neutral"
      dadFace.classList.remove("mad", "happy");
      if (mood === "happy") {
        dadFace.classList.add("happy");
        dadFace.textContent = "ğŸ˜";
      } else if (mood === "mad") {
        dadFace.classList.add("mad");
        dadFace.textContent = "ğŸ˜¡";
      } else if (mood === "neutral") {
        dadFace.textContent = "ğŸ˜";
      } else {
        dadFace.textContent = "ğŸ˜´";
      }
    }

    function setBubble(text) {
      bubble.textContent = text;
      bubble.classList.remove("pop");
      // é‡æ–°è§¸ç™¼å‹•ç•«
      void bubble.offsetWidth;
      bubble.classList.add("pop");
    }

    function doShake() {
      door.classList.remove("shake");
      void door.offsetWidth;
      door.classList.add("shake");
    }

    function handleKnock(isBigDaughter) {
      initAudio(); // ç¢ºä¿åœ¨ç¬¬ä¸€æ¬¡é»æ“Šæ™‚å•Ÿå‹• AudioContext

      const { isWeekend, isOnDutyTime, hour } = getStatus();

      // é€±æœ«ï¼šè€ç«‡æ­»å””èµ·èº« mode
      if (isWeekend) {
        setDadMood("sleep");
        setBubble("é€±æœ«å–ï¼Œè€ç«‡æ’å’—å‡æœŸç“è¦ºï¼Œå””ç†ä½ å“‹å…©å§Šå¦¹ã€‚");
        playNeutralSound();
        doShake();
        door.classList.remove("open");
        return;
      }

      // å¹³æ—¥ï¼Œæ ¹æ“šä¿‚å¤§å¥³å®šç´°å¥³
      if (isBigDaughter) {
        // å¤§å¥³æ•²é–€
        if (isOnDutyTime) {
          // æ­£ç¢ºæ™‚é–“ + å¹³æ—¥ => è¶…é–‹å¿ƒé–‹é–€
          setDadMood("happy");
          setBubble("å“å‘€ï½å¤§å¥³è¿”åšŸå•¦ï¼è€ç«‡å³åˆ»å¹«ä½ é–‹é–€å…ˆï½â¤");
          playHappySound();
          door.classList.add("open");
        } else {
          // å¹³æ—¥ä½†å””ä¿‚ 18:00
          setDadMood("neutral");
          door.classList.remove("open");
          if (hour < 18) {
            setBubble("æœªåˆ°å…­é»å‘€å¤§å¥³ï¼Œè€ç«‡ä»² OT ç·Šï¼Œç­‰é™£å…ˆå†æ•²å•¦ã€‚");
          } else {
            setBubble("éå’—å…­é»å•¦ï¼Œä½ éƒ½è­˜å¤œæ­¸å«ï¼Ÿè€ç«‡æ”°åˆ°ä»†è¡—ï¼Œè½æ—¥æº–æ™‚å•²å•¦ã€‚");
          }
          playNeutralSound();
          doShake();
        }
      } else {
        // ç´°å¥³æ•²é–€ï¼šè€ç«‡é¬§äºº
        setDadMood("mad");
        door.classList.remove("open");

        if (isOnDutyTime) {
          setBubble("å–‚åˆä¿‚ä½ ç´°å¥³ï¼Ÿï¼è€ç«‡æ·¨ä¿‚ç´„å’—å¤§å¥³ 18:00 é–‹é–€ï¼Œä½ è‡ªå·±æµé–åŒ™å•¦ï¼");
        } else {
          if (hour < 18) {
            setBubble("ç´°å¥³ä½ åˆå–ºåº¦å˜ˆï¼Ÿæœªåˆ°å…­é»åˆæµè€ç«‡ï¼Œæ”¶è²è¿”å»æº«æ›¸å•¦ï¼");
          } else {
            setBubble("ç´°å¥³ï¼Œä½ çŸ¥å””çŸ¥å¹¾å¤œï¼Ÿè€ç«‡æƒ³ç“è¦ºï¼å†æ•²æˆ‘æ”¶ä½ é›»è©±ï¼");
          }
        }
        playAngrySound();
        doShake();
      }
    }

    btnBig.addEventListener("click", () => handleKnock(true));
    btnSmall.addEventListener("click", () => handleKnock(false));

    // åˆå§‹è¡¨æƒ…
    setDadMood("sleep");
  </script>
</body>
</html>
